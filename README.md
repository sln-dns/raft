# Raft - RAG система для HIPAA регуляций

RAG (Retrieval-Augmented Generation) система для поиска и генерации ответов по HIPAA регуляциям с точными цитатами.

## Что это

Система отвечает на вопросы по HIPAA регуляциям, используя:
- **Классификацию вопросов** - определяет тип вопроса (определение, штрафы, процедуры и т.д.)
- **Специализированные ретриверы** - ищут релевантные фрагменты в базе данных
- **Генерацию ответов** - создает структурированные ответы с точными цитатами

## Архитектура

```
Вопрос → Классификатор → Ретривер → Генератор → Ответ с цитатами
```

### Компоненты

**1. Классификатор** (`classifier.py`)
- Определяет категорию вопроса (10 типов: definition, penalties, scope, citation-required и т.д.)
- Использует LLM для классификации

**2. Ретриверы** (`retrievers/`)
- Специализированные ретриверы для каждой категории вопросов
- Гибридный поиск: векторный (pgvector) + полнотекстовый (FTS)
- Типы: `DefinitionRetriever`, `PenaltiesRetriever`, `CitationRetriever`, `GeneralRetriever` и др.

**3. Генератор** (`generator/`)
- Преобразует найденные чанки в структурированные ответы
- Валидация цитат (проверка точности anchor'ов)
- Политики генерации для разных типов вопросов

**4. API** (`app.py`)
- FastAPI с тремя эндпойнтами:
  - `/classify` - классификация вопроса
  - `/search` - поиск релевантных чанков
  - `/answer` - полный ответ с генерацией

**5. UI** (`ui_simple.py`)
- Streamlit интерфейс для тестирования API

## Технологии

- **Backend**: FastAPI, Python 3.11
- **База данных**: PostgreSQL 17 + pgvector (векторный поиск)
- **LLM**: OpenAI API (Claude, GPT) для классификации и генерации
- **Embeddings**: Qwen3-embedding-8b
- **Деплой**: Docker Compose

## База данных

- **Структура**: документы → секции → чанки (atomic/section)
- **Поиск**: гибридный (векторный + FTS)
- **Индексы**: pgvector для эмбеддингов, GIN для FTS

## Быстрый старт

### Локальная разработка

```bash
# Установка зависимостей
uv sync

# Запуск API
uvicorn app:app --reload

# Запуск UI
streamlit run ui_simple.py
```

### Деплой

См. [deploy/README_DEPLOY.md](deploy/README_DEPLOY.md)

## Структура проекта

```
raft/
├── app.py              # FastAPI приложение
├── classifier.py       # Классификатор вопросов
├── retrievers/         # Специализированные ретриверы
├── generator/          # Генератор ответов
├── embeddings.py       # Клиент для эмбеддингов
├── ui_simple.py       # Streamlit UI
└── deploy/            # Docker Compose конфигурация
```

## Основные файлы

- `app.py` - API эндпойнты
- `classifier.py` - классификация вопросов
- `retrievers/utils.py` - подключение к БД, утилиты
- `retrievers/registry.py` - выбор ретривера по категории
- `generator/generator.py` - генерация ответов
- `deploy/docker-compose.yml` - конфигурация деплоя
